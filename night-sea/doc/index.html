<!doctype html>
<html lang="en">
<head>
  <!-- To configure: set <title> & MD_URI -->
  <!-- This file was developed with the help of GAI --> 
  <meta charset="utf-8" />
  <title>https://dcpetty.dev/p5js/night-sea/</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Optional: GitHub-style CSS for nicer Markdown appearance -->
  <link rel="stylesheet" href="https://unpkg.com/github-markdown-css@5.5.1/github-markdown.css">

  <style>
    body { margin: 0; padding: 2rem; background: #fff; }
    #content { padding: 1rem; border: thick solid #eee; }
    .markdown-body { min-width: 800px; max-width: 80%; margin: 0 auto; }
    /* Improve KaTeX/MathJax spacing inside headings and lists */
    .markdown-body h1, .markdown-body h2, .markdown-body h3,
    .markdown-body h4, .markdown-body h5, .markdown-body h6 {
      line-height: 1.2;
    }
    .markdown-body pre, .markdown-body code {
      font-family: ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
  </style>

  <!-- Configure MathJax BEFORE loading the script -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        // Skip math processing inside these tags
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
        // But allow math inside elements with these classes if you need
        includeHtmlTags: { ['math']: [] }
      },
      // Only typeset inside our content container to avoid scanning the whole page
      startup: {
        ready: () => {
          // Defer to explicit typeset calls we make after marked renders
          // MathJax will still initialize fonts etc.
          MathJax.startup.defaultReady();
        }
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" async></script>
</head>
<body>
  <article id="content" class="markdown-body">Loading…</article>

  <!-- Marked (Markdown parser). SRI matches unpkg’s current served file. -->
  <script
    src="https://unpkg.com/marked@12.0.2/marked.min.js"
    integrity="sha384-/TQbtLCAerC3jgaim+N78RZSDYV7ryeoBCVqTuzRrFec2akfBkHS7ACQ3PQhvMVi"
    crossorigin="anonymous">
  </script>

  <!-- Optional: DOMPurify if your markdown is untrusted. Uncomment to use. -->
  <!--
  <script src="https://unpkg.com/dompurify@3.1.6/dist/purify.min.js"></script>
  -->

  <script>
    // Configure marked
    marked.setOptions({
      gfm: true,
      breaks: true,
      headerIds: true,
      mangle: false,    // preserve e-mail addresses
    });

    async function fetchMarkdown(path) {
      const res = await fetch(path, { cache: 'no-cache' });
      if (!res.ok) throw new Error(`Failed to load ${path}: ${res.status} ${res.statusText}`);
      return res.text();
    }

    async function render(path = './README.md') {
      const container = document.getElementById('content');
      try {
        const md = await fetchMarkdown(path);
        const html = marked.parse(md);

        // If using DOMPurify, sanitize. Ensure KaTeX/MathJax tags/attrs are allowed if needed.
        // const safe = DOMPurify.sanitize(html, { USE_PROFILES: { html: true } });
        // container.innerHTML = safe;

        container.innerHTML = html;

        // Typeset math after the HTML is injected.
        // MathJax v3: use typesetPromise to wait until finish.
        if (window.MathJax && MathJax.typesetPromise) {
          await MathJax.typesetClear([container]);  // clear previous typeset if re-rendering
          await MathJax.typesetPromise([container]);
        }
      } catch (err) {
        console.error(err);
        container.textContent = String(err);
      }
    }

    // Initial render
    MD_URI = `https://dcpetty.dev/p5js/night-sea/doc/README.md`
    render(MD_URI);

    // Example: if you want to re-render a different file later, call:
    //   render('path/to/file.md')
    //   window.renderMarkdownFile = render;
  </script>
</body>
</html>

